
--EJERCICIO 1 CREACION DE TABLAS
CREATE TABLE DIRECTOR (
NOMBRE VARCHAR2(20) PRIMARY KEY,
NACIONALIDAD VARCHAR2(20)
);

CREATE TABLE PELICULA (
ID VARCHAR2(10) PRIMARY KEY,
TITULO VARCHAR2(20) NOT NULL,
PRODUCTORA VARCHAR2(20),
NACIONALIDAD VARCHAR2(20),
FECHA DATE,
DIRECTOR VARCHAR2(20) REFERENCES DIRECTOR
);

CREATE TABLE ACTORES (
NOMBRE VARCHAR2(20) PRIMARY KEY,
NACIONALIDAD VARCHAR2(20),
SEXO VARCHAR2(1) CHECK (SEXO='H' OR SEXO='M')
);

CREATE TABLE ACTUA (
ACTOR VARCHAR2(20) REFERENCES ACTORES,
ID_PELI VARCHAR2(10) REFERENCES PELICULA,
PROTA VARCHAR2(2) CHECK (PROTA='S' OR PROTA='N') DEFAULT 'N',
PRIMARY KEY (ACTOR, ID_PELI)
);

CREATE TABLE SOCIO (
DNI VARCHAR2(10) PRIMARY KEY,
NOMBRE VARCHAR2(20) NOT NULL,
DIRECCION VARCHAR2(20),
TELEFONO VARCHAR2(9),
AVALADOR VARCHAR2(10) REFERENCES SOCIO

);

CREATE TABLE EJEMPLAR (
ID_PELI VARCHAR2(10) REFERENCES PELICULA,
ESTADO VARCHAR2(20),
NUMERO VARCHAR2(20),
PRIMARY KEY (ID_PELI, NUMERO)
);

CREATE TABLE ALQUILA (
FECHAALQUILER DATE,
FECHADEVOLUCION DATE CHECK (FECHADEVOLUCION > FECHAALQUILER),
DNI VARCHAR2(10) REFERENCES SOCIO,
ID_PELI VARCHAR2(10),
NUMERO VARCHAR2(20),
CONSTRAINT FK_NUM_PERSO FOREIGN KEY (NUMERO, ID_PELI) REFERENCES EJEMPLAR,
PRIMARY KEY (FECHAALQUILER, DNI, ID_PELI, NUMERO)
);



--APARTADO A
INSERT INTO DIRECTOR VALUES ('JAVIER', 'SPAIN');
INSERT INTO DIRECTOR VALUES ('PACO', 'SPAIN');

INSERT INTO PELICULA VALUES ('001', 'TITULO1', 'PRODUCTORA1', 'SPAIN', '29-05-1998', 'PACO');
INSERT INTO PELICULA VALUES ('002', 'TITULO2', 'PRODUCTORA2', 'SPAIN', '29-05-1998', 'PACO');
INSERT INTO PELICULA VALUES ('003', 'TITULO3', 'PRODUCTORA3', 'SPAIN', '29-05-1998', 'JAVIER');
INSERT INTO PELICULA VALUES ('004', 'TITULO4', 'PRODUCTORA4', 'SPAIN', '29-05-1998', 'JAVIER');

INSERT INTO EJEMPLAR VALUES ('001', 'BUENO', '001');
INSERT INTO EJEMPLAR VALUES ('002', 'BUENO', '001');
INSERT INTO EJEMPLAR VALUES ('003', 'BUENO', '002');
INSERT INTO EJEMPLAR VALUES ('004', 'BUENO', '002');
INSERT INTO EJEMPLAR VALUES ('005', 'BUENO', '003');
INSERT INTO EJEMPLAR VALUES ('006', 'BUENO', '003');
INSERT INTO EJEMPLAR VALUES ('007', 'BUENO', '004');
INSERT INTO EJEMPLAR VALUES ('008', 'BUENO', '004');

INSERT INTO SOCIO VALUES ('29497784P', 'MANUEL','C/HUELVA Nº24', '675446700', '29497784P');
INSERT INTO SOCIO VALUES ('29497785P', 'TRINI','C/HUELVA Nº24', '675446701', '29497784P');
INSERT INTO SOCIO VALUES ('29497786P', 'CARLOS','C/HUELVA Nº24', '675446700', '29497785P');
INSERT INTO SOCIO VALUES ('29497787P', 'ALFONSO','C/HUELVA Nº24', '675446706', '29497786P');

INSERT INTO ACTORES VALUES ('JAVIER', 'SPAIN', 'H');
INSERT INTO ACTORES VALUES ('MANUEL', 'SPAIN', 'H');
INSERT INTO ACTORES VALUES ('SOFIA', 'SPAIN', 'M');
INSERT INTO ACTORES VALUES ('PACO', 'SPAIN', 'H');
INSERT INTO ACTORES VALUES ('MERCEDES', 'SPAIN', 'M');
INSERT INTO ACTORES VALUES ('ANTONIO', 'SPAIN', 'H');

INSERT INTO ACTUA VALUES ('JAVIER', '001', 'S');
INSERT INTO ACTUA VALUES ('JAVIER', '002', 'S');
INSERT INTO ACTUA VALUES ('JAVIER', '003', 'S');
INSERT INTO ACTUA VALUES ('JAVIER', '004', 'S');
INSERT INTO ACTUA VALUES ('MANUEL', '001', 'N');

INSERT INTO ALQUILA VALUES ('07-01-2020', '13-01-2020', '29497784P', '001', '001');
INSERT INTO ALQUILA VALUES ('07-01-2020', '13-01-2020', '29497784P', '002', '002');
INSERT INTO ALQUILA VALUES ('07-01-2020', '13-01-2020', '29497784P', '003', '003');
INSERT INTO ALQUILA VALUES ('07-01-2020', '13-01-2020', '29497784P', '004', '004');

--APARTADO B
INSERT INTO SOCIO VALUES ('29497784P', '','C/HUELVA Nº24', '675446700', '29497784P');
INSERT INTO PELICULA VALUES ('001', '', 'PRODUCTORA1', 'SPAIN', '29-05-1998', 'PACO');
/*VEMOS COMO NO NOS DEJA INCLUIRLO DEBIDO A LA RESTRICCION*/

--APARTADO C
INSERT INTO ACTORES VALUES ('JAVIER', 'SPAIN', 'J');
/*NO NOS DEJA, NOS DICE RESTRICCION DE CONTROL VIOLADA*/

--APARTADO D
INSERT INTO ACTUA VALUES ('JAVIER', '001' , '') ;
INSERT INTO ACTUA VALUES ('JAVIER', '001' , 'G') ;
/* SI NO LE PONEMOS NADA POR DEFECTO NOS PONE QUE EL ACTOR NO ES PRORAFONISTA,
EN CAMBIO, CUANDO LE PONES UN VALOR QUE NO SEA 'S' O 'N' NOS SALE UN ERROR 
DICIENDO QUE LA RESTRICCION HA SIDO VIOLADA*/

--APARTADO E
INSERT INTO ALQUILA VALUES('02-01-2020', '01-01-2020', '29497784', '001', '001');
/*NO NOS DEJA HACER ESTE INSERT, YA QUE LA FECHA DE ENTREGA ES ANTERIOR A LA FECHA DE 
DEVOLUCION, POR LO QUE NUESTRA RESTRICCION FUNCIONA PERFECTAMENTE*/

--APARTADO F
UPDATE DIRECTOR SET NACIONALIDAD = 'ESP' WHERE NACIONALIDAD = 'SPAIN';

--APARTADO G
UPDATE ACTORES SET NACIONALIDAD = 'ESP' WHERE NACIONALIDAD = 'SPAIN';

--APARTADO H
UPDATE SOCIO SET AVALADOR = '29497784P' WHERE AVALADOR != '29497784P';

--APARTADO I
DELETE FROM SOCIO WHERE TELEFONO LIKE ('4%') OR TELEFONO LIKE ('3%') OR TELEFONO LIKE ('2%') OR TELEFONO LIKE ('1%') OR TELEFONO LIKE ('0%');
/* NO NOS DEJA BORRARLO YA QUE LAS CLAVES PRIMARIAS DE SOCIO SE ESTAN UTILIANDO EN LA TABLA ALQUILA, Y AL NO
TENER UN ON DELETE EN CASCADE NO PODEMOS ELIMINARLA SIN ANTES ELIMINAR LOS REGISTROS QUE ESTAN USANDO ESAS CLAVES PRIMARIAS
*/

--APARTADO J
DELETE FROM SOCIO WHERE TELEFONO LIKE ('6%') OR TELEFONO LIKE ('7%') OR TELEFONO LIKE ('8%') OR TELEFONO LIKE ('9%');
/* POR LO MISMO QUE EN EL APARTADO ANTERIOR, NO NOS DEJA BORRARLO YA QUE LAS CLAVES PRIMARIAS DE SOCIO SE ESTAN UTILIANDO EN LA TABLA ALQUILA, Y AL NO
TENER UN ON DELETE EN CASCADE NO PODEMOS ELIMINARLA SIN ANTES ELIMINAR LOS REGISTROS QUE ESTAN USANDO ESAS CLAVES PRIMARIAS
*/

--APARTADO K
/* SI SE PODRIA HABER EVITADO, PONIENDO UN ON DELETE EN CASCADE EN LA TABLE SOCIOS, ASI
CUANDO SE QUIERA BORRAR SUS REGISTROS SE BORRARÁN TAMBIEN AQUELLOS QUE LO ESTÉN UTILIZANDO.
*/

--APARTADO L
DELETE FROM DIRECTOR;
/* LO MISMO QUE ANTES, NO PODEMOS ELIMINARLO PORQUE LAS CLAVES PRIMARIAS DE DIRECTORES SE ESTÁN UTILIZANDO EN 
PELÍCULA, AL NO HABER PUESTO EL ON DELETE EN CASCADE EN LA TABLA DIRECTOR NO PODEMOS ELIMINARLO DE ESTA FORMA*/

--APARTADO M
DELETE FROM PELICULA WHERE TITULO = 'TITULO1';
DELETE FROM PELICULA WHERE TITULO = 'TITULO2';
/* SI MISMO QUE EN LOS APARTADOS ANTERIORES, EL PROBLEMA ES EL NO HABER PUESTO EL ON DELETE EN CASCADE, Y AL UTILIZAR
ESTOS REGISTROS EN OTRAS TABLAS PUES FALLA, SE PODRIA SOLUCIONAR ELIMINANDO ANTES LAS TABLAS DONDE HEMOS UTILIZADO ALGUN REGISTRO
DE ESTA, O BIEN HACER UNA MODIFICACION Y PONER ON DELETE EN CASCADE EN LA TABLA
PELICULA*/
