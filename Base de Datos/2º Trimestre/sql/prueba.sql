-- Creacion de usuario DMLJavier
-- Apartado1
CREATE TABLE PROFESOR (
IDPROFESOR NUMBER(9) PRIMARY KEY,
NIF_P VARCHAR2(10),
NOMBRE VARCHAR2(20),
ESPECIALIDAD VARCHAR2(20),
TELEFONO VARCHAR2(9)
);

CREATE TABLE ASIGNATURA (
CODASIGNATURA VARCHAR2(9) PRIMARY KEY,
NOMBRE VARCHAR2(20),
IDPROFESOR NUMBER(9) REFERENCES PROFESOR
);

CREATE TABLE ALUMNO (
NUMMATRICULA NUMBER(9) PRIMARY KEY,
NOMBRE VARCHAR2(20),
FECHANACIMIENTO DATE,
TELEFONO VARCHAR2(9)
);

CREATE TABLE RECIBE (
CURSOESCOLAR VARCHAR2(20),
NUMMATRICULA NUMBER(9) REFERENCES ALUMNO,
CODASIGNATURA VARCHAR2(9) REFERENCES ASIGNATURA,
PRIMARY KEY (CURSOESCOLAR, NUMMATRICULA, CODASIGNATURA)
);

--APARTADO 2
INSERT INTO PROFESOR VALUES(123, '29497784P', 'JAVIER', 'PROGRAMACION', '675446757');
INSERT INTO PROFESOR VALUES(1234, '29497785P', 'MANUEL', 'INGLES', '675446758');

INSERT INTO ASIGNATURA VALUES('1A', 'LENGUA', '123');
INSERT INTO ASIGNATURA VALUES('2A', 'MATEMATICAS', '1234');
INSERT INTO ASIGNATURA VALUES('3A', 'LATIN', '123');
INSERT INTO ASIGNATURA VALUES('4A', 'INFORMATICA', '1234');

INSERT INTO ALUMNO VALUES(1, 'ANTONIO', '29-05-1998', '675446700');
INSERT INTO ALUMNO VALUES(2, 'JOSE', '28-05-1998', '675446701');
INSERT INTO ALUMNO VALUES(3, 'JOSE', '27-05-1998', '675446702');
INSERT INTO ALUMNO VALUES(4, 'MARIO', '26-05-1998', '675446703');
INSERT INTO ALUMNO VALUES(5, 'LUCIA', '25-05-1998', '675446704');
INSERT INTO ALUMNO VALUES(6, 'MARIA', '24-05-1998', '675446705');
INSERT INTO ALUMNO VALUES(7, 'CLAUDIA', '23-05-1998', '675446706');
INSERT INTO ALUMNO VALUES(8, 'RAFA', '22-05-1998', '675446707');
INSERT INTO ALUMNO VALUES(9, 'CRISTINA', '21-05-1998', '675446708');
INSERT INTO ALUMNO VALUES(10, 'JAIME', '20-05-1998', '675446709');

INSERT INTO RECIBE VALUES('2000',1, '1A');
INSERT INTO RECIBE VALUES('2000',1, '2A');
INSERT INTO RECIBE VALUES('2000',2, '1A');
INSERT INTO RECIBE VALUES('2000',2, '2A');
INSERT INTO RECIBE VALUES('2000',3, '1A');
INSERT INTO RECIBE VALUES('2000',3, '2A');
INSERT INTO RECIBE VALUES('2000',4, '1A');
INSERT INTO RECIBE VALUES('2000',4, '2A');
INSERT INTO RECIBE VALUES('2000',5, '1A');
INSERT INTO RECIBE VALUES('2000',5, '2A');
INSERT INTO RECIBE VALUES('2000',6, '3A');
INSERT INTO RECIBE VALUES('2000',6, '4A');
INSERT INTO RECIBE VALUES('2000',7, '3A');
INSERT INTO RECIBE VALUES('2000',7, '4A');
INSERT INTO RECIBE VALUES('2000',8, '3A');
INSERT INTO RECIBE VALUES('2000',8, '4A');
INSERT INTO RECIBE VALUES('2000',9, '3A');
INSERT INTO RECIBE VALUES('2000',9, '4A');
INSERT INTO RECIBE VALUES('2000',10, '3A');
INSERT INTO RECIBE VALUES('2000',10, '4A');

--APARTADO 3
--NO DEJA INTRODUCIRLO PORQUE EL NUMERO DE MATRICULA ES UNA RESTRICCION ÚNICA
INSERT INTO ALUMNO VALUES(11, 'TRINI', '20-05-1998', '675446709');
INSERT INTO ALUMNO VALUES(11, 'SOFIA', '20-05-1998', '675446709');
/*ESA ES LA SENTENCIA QUE HEMOS INTENTADO INTRODUCIR PERO NO NOS DEJA,
YA QUE EL NUMERO DE MATRICULA ES UNA CLAVE PRIMARIA, POR LO QUE NO PUEDE
REPETIRSE, PARA PODER INTRODUCIR A ESOS ALUMNOS TENDREMOS QUE PONERLES
NUMEROS DE MATRICULAS DISTINTOS
NOS HA INTRODUCIDO AL PRIMERO QUE HEMOS INTENTADO CON ESE NUMERO DE MATRICULA*/

--APARTADO 4
INSERT INTO ALUMNO VALUES(14, 'SOFIA', '20-05-1998', '');
INSERT INTO ALUMNO VALUES(14, 'LUCAS', '20-05-1998', '');
INSERT INTO ALUMNO VALUES(14, 'JUAN', '20-05-1998', '');

--APARTADO 5
UPDATE ALUMNO SET TELEFONO = '675446711' WHERE NUMMATRICULA =12;
UPDATE ALUMNO SET TELEFONO = '675446712' WHERE NUMMATRICULA =13;
UPDATE ALUMNO SET TELEFONO = '675446713' WHERE NUMMATRICULA =14;

--APARTADO 6
UPDATE ALUMNO SET FECHANACIMIENTO = '22-07-1981' WHERE FECHANACIMIENTO >= '01-01-2000';

--APARTADO 7
UPDATE PROFESOR SET ESPECIALIDAD = 'INFORMATICA' WHERE TELEFONO IS NOT NULL AND NIF_P NOT LIKE ('9%');

--APARTADO 8
DELETE FROM RECIBE WHERE CODASIGNATURA ='1A';

--APARTADO 9
DELETE FROM ASIGNATURA WHERE CODASIGNATURA ='1A';

--APARTADO 10
DELETE FROM ASIGNATURA WHERE CODASIGNATURA ='2A' OR CODASIGNATURA ='3A' OR CODASIGNATURA ='4A';
/*ESE SERIA EL COMANDO, PERO NO FUNCIONA YA QUE ESOS CODIGO DE ASIGNATURAS SE ESTAN
UTILIZANDO EN LA TABLA RECIBE, SE PODRIA SOLUCIONAR ELIMINANDO ANTES LOS REGISTROS QUE TIENEN 
ASOCIADOS ESOS CODIGOS DE ASIGNATURA DE LA TABLA RECIBE, ES DECIR TODOS.
SE PODRÍA HABER EVITADO PONIENDO EN LA TABLA ASIGNATURAS ON DELETE EN CASCADA,
DE ESTA FORMA SE BORRARÍA TODO LO QUE CONTUVIESE LOS CODIGOS DE LAS ASIGNATURAS.
AHORA MISMO LO MAS SENCILLO SERÍA BORRAR PRIMERO TODOS LOS REGISTROS DE LA TABLA RECIBE Y POSTERIORMENTE
BORRARLO TODO DE LA TABLA ASIGNATURAS, ES DECIR, LOS COMANDOS:
*/
DELETE FROM RECIBE WHERE CODASIGNATURA ='2A' OR CODASIGNATURA ='3A' OR CODASIGNATURA ='4A';
DELETE FROM ASIGNATURA WHERE CODASIGNATURA ='2A' OR CODASIGNATURA ='3A' OR CODASIGNATURA ='4A';

--APARTADO 11

--APARTADO 12

UPDATE ALUMNO SET NOMBRE = UPPER(NOMBRE)
WHERE NOMBRE = LOWER(NOMBRE); 

--APARTADO 13
CREATE TABLE ALUMNO_BACKUP (
NUMMATRICULA NUMBER(9) PRIMARY KEY,
NOMBRE VARCHAR2(20),
FECHANACIMIENTO DATE,
TELEFONO VARCHAR2(9)
);

INSERT INTO ALUMNO_BACKUP SELECT * FROM ALUMNO;
